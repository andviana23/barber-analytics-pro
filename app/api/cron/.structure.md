# üîÑ Estrutura de Cron Jobs ‚Äî IA Financeira

Todos os cron jobs executam automaticamente via Vercel Cron Scheduler.

## üìã Endpoints Dispon√≠veis

### `/api/cron/etl-diario`

- **Schedule:** `0 3 * * *` (03:00 BRT diariamente)
- **Responsabilidade:** Executar ETL di√°rio, processar receitas/despesas, calcular m√©tricas
- **Entrada:** Nenhuma (busca unidades ativas automaticamente)
- **Sa√≠da:** JSON com status da execu√ß√£o
- **Timeout:** 10 minutos

### `/api/cron/relatorio-semanal`

- **Schedule:** `0 6 * * 1` (Segunda-feira 06:00)
- **Responsabilidade:** Gerar relat√≥rio semanal com an√°lise IA
- **Sa√≠da:** Relat√≥rio enviado via Telegram

### `/api/cron/fechamento-mensal`

- **Schedule:** `0 7 1 * *` (1¬∫ do m√™s 07:00)
- **Responsabilidade:** Calcular DRE, comparar targets, gerar sum√°rio executivo
- **Sa√≠da:** Relat√≥rio completo enviado via Telegram

### `/api/cron/enviar-alertas`

- **Schedule:** `*/15 * * * *` (A cada 15 minutos)
- **Responsabilidade:** Enviar alertas pendentes via Telegram
- **L√≥gica:** Busca alertas com status OPEN, envia, marca como ACKNOWLEDGED

### `/api/cron/health-check`

- **Schedule:** `*/5 * * * *` (A cada 5 minutos)
- **Responsabilidade:** Validar sa√∫de do sistema (Supabase, OpenAI, storage)
- **Alertas:** Envia alertas cr√≠ticos via Telegram se habilitado

## üîê Autentica√ß√£o

Todos os endpoints requerem:

- Header `Authorization: Bearer {CRON_SECRET}`
- Valida√ß√£o do IP (Vercel)

## ‚ö†Ô∏è Importante

- Cada cron job √© **idempotente** (pode executar m√∫ltiplas vezes sem problemas)
- Execu√ß√µes s√£o registradas em `etl_runs` para auditoria
- Em caso de falha, alerta √© enviado via Telegram
